es_host: datana-logs.datana.ru
es_port: 9200
run_every:
  minutes: 10

name: Socket Adapter Of Datana Smart

index: datana-smart-dev-logs-*
####index: datana-smart-test-logs-*
# A rule that matches if num_events number of events occur within a timeframe
num_events: 1

###################################
type: any

timeframe:
  seconds: 2

buffer_time:
  minutes: 60

alert_time_limit:
  days: 1

realert:
  minutes: 10

filter:
  - query:
      query_string:
        query: "NOT (@timestamp >= 'now-1s' AND logger_name: ru.datana.integrationadapter.socket.integration.connector.S7Api AND message: *Получена data из S7Connector и создан МultiSensorModel объект с sensorTemperatureUUID*)"
###        query: "(NOT _exists_ @timestamp) OR NOT (logger_name: ru.datana.integrationadapter.socket.integration.connector.S7Api AND message: *Получена data из S7Connector и создан МultiSensorModel объект с sensorTemperatureUUID*)"

        ### query: "@timestamp >= 'now-1s' AND _exists_ logger_name: ru.datana.integrationadapter.socket.integration.connector.S7Api AND _exists message: *Получена data из S7Connector и создан МultiSensorModel объект с sensorTemperatureUUID*"
        ###query: "(@timestamp >= 'now-1s') AND (NOT _exists_ logger_name: ru.datana.integrationadapter.socket.integration.connector.S7Api AND NOT _exists message: *Получена data из S7Connector и создан МultiSensorModel объект с sensorTemperatureUUID*)"
alert:
  - "telegram"

use_local_time: True

## телеграм для релизов датаны (для примера взято)
##      def final constTelegramReleaseURL = "https://api.telegram.org/bot1171367749:AAFgyOW0LGRLl9NHo9TkZIGNUdd6cFKYGqo/sendMessage?chat_id=-1001451379215&parse_mode=HTML"

telegram_bot_token: 1171367749:AAFgyOW0LGRLl9NHo9TkZIGNUdd6cFKYGqo

telegram_room_id: "@DatanaReleaseEvent"

alert_text: "from elastalert - {0}, {1}, {2}, {3}"
alert_text_args: ["hostname", "component", "message", "@timestamp"]
### alert_text_type: alert_text_only


query_key: [logger_name, message]
include: [logger_name, message]
top_count_keys: [logger_name, message]


#smtp_host: 'mysmtpserverfqdn'
#smtp_port: 587
#smtp_ssl: true
#from_addr: 'notifications@mydomain.com'
#smtp_auth_file: '/opt/elastalert/smtp_auth_file'