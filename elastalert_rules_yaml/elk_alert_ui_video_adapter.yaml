## https://elastalert.readthedocs.io/en/latest/ruletypes.html#metric-aggregation

#run_every:
#  minutes: 10


#===========================================================
#metric_aggregation: This rule matches when the value of a metric within the calculation window is higher or lower than a threshold. By default this is buffer_time.
#
#This rule requires:
#
#metric_agg_key: This is the name of the field over which the metric value will be calculated. The underlying type of this field must be supported by the specified aggregation type.
#
#metric_agg_type: The type of metric aggregation to perform on the metric_agg_key field. This must be one of ‘min’, ‘max’, ‘avg’, ‘sum’, ‘cardinality’, ‘value_count’.
#
#doc_type: Specify the _type of document to search for.
#
#This rule also requires at least one of the two following options:
#
#max_threshold: If the calculated metric value is greater than this number, an alert will be triggered. This threshold is exclusive.
#
#min_threshold: If the calculated metric value is less than this number, an alert will be triggered. This threshold is exclusive.


#===========================================================

name: Socket Adapter Of Datana Smart

####index: ${RULE_INDEX}
index: datana-smart-dev-logs-*
####index: datana-smart-test-logs-*
# A rule that matches if num_events number of events occur within a timeframe
num_events: 10

###################################
type: metric_aggregation

buffer_time:
  hours: 10

metric_agg_key: system.cpu.user.pct
metric_agg_type: avg
query_key: level
doc_type: _doc

bucket_interval:
  minutes: 5

sync_bucket_interval: true
#allow_buffer_time_overlap: true
#use_run_every_query_size: true

min_threshold: 10
max_threshold: 100

filter:
- term:
    level: DEBUG
    ## field: ["value1", "value2"] # value1 OR value2

# (Required)
# The alert is use when a match is found
alert:
- "debug"

